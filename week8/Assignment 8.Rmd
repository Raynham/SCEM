---
title: "Assignment 8"
author: "Ruinan Wang"
date: "24/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(PairedData)
library(purrr)
library(tidyr)
```

## 1. Obstacles to valid scientific inference

### Measurement Distortions: It is a kind of difference between the measured value of a quantity and its true value.   

Example: Measure inaccurately the speed a athlete run 100 miles

### Selection bias: Selection bias is the bias introduced by the selection of individuals, groups, or data for analysis in such a way that proper randomization is not achieved, thereby failing to ensure that the sample obtained is representative of the population of interest

Example: When testing if a medicine is effective or not, student candidates become the main subjects.


### Confounding variables: It is a variable that essfects causal relationship measurement between the indepedent variables X and depedent variables Y  
Confounding variables (a.k.a. confounders or confounding factors) are a type of extraneous variable that are related to a studyâ€™s independent and dependent variables. A variable must meet two conditions to be a confounder:

It must be correlated with the independent variable. This may be a causal relationship, but it does not have to be.
It must be causally related to the dependent variable.

Example: You find that babies born to mothers who smoked during their pregnancies weigh significantly less than those born to non-smoking mothers, but without thinking the subject are also likely to engage in other unhealthy behaviors, which is the confounding variables.

### 2 An unpaired t test  

```{r}

t_test_function <- function(data,val_col,group_col, var_equal){
  data <- data%>%
    group_by(!!sym(group_col))%>%
    summarize(avg=mean(!!sym(val_col)),num = n(), sd = sd(!!sym(val_col)))
  
  n1 = data$num[1]
  n2 = data$num[2]
  mean1 = data$avg[1]
  mean2 = data$avg[2]
  sd1 = data$sd[1]
  sd2 = data$sd[2]
if (var_equal == FALSE){
  t_statistic <- (mean1-mean2)/sqrt(sd1^2/n1+sd2^2/n2)
  dof <- (sd1^2/n1+sd2^2/n2)^2/((sd1^2/n1)^2/(n1-1)+(sd2^2/n2)^2/(n2-1))
  p_value <- 2*(1-pt(abs(t_statistic),df=dof))
}    
  else{
  dof <- n1+n2-2
  sd_combined <- sqrt(((n1-1)*sd1^2+(n2-1)*sd2^2)/(dof))
  t_statistic <- (mean1-mean2)/(sd_combined*sqrt(1/n1+1/n2))
  p_value <- 2*(1-pt(abs(t_statistic),df=dof))
  effect_size <- (mean1-mean2)/sd_combined
}
  return(data.frame(t_statistic,dof,p_value))
}

library(palmerpenguins)
peng_AC<-penguins%>%
drop_na(species,body_mass_g)%>%
filter(species!="Gentoo")

t_test_function(data=peng_AC,val_col="body_mass_g",group_col="species", var_equal = FALSE)
t.test(body_mass_g~species, data = peng_AC, var.equal=FALSE)
t_test_function(data=peng_AC,val_col="body_mass_g",group_col="species", var_equal = TRUE)
t.test(body_mass_g~species, data = peng_AC, var.equal=TRUE) 

```



## 3.Statistical hypothesis testing  
      1.Null hypothesis: 







